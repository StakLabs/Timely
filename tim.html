<!----><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>title</title>
    <style>
    *   {
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background: #111;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
        }

        input#ask {
            width: 90%;
            max-width: 600px;
            padding: 15px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 10px;
            background: #222;
            color: #fff;
            outline: none;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: all 0.2s ease-in-out;
        }

        input#ask:focus {
            background: #333;
            box-shadow: 0 0 15px #00f2ff;
        }

        #response {
            margin-top: 20px;
            padding: 20px;
            width: 90%;
            max-width: 700px;
            background: #1a1a1a;
            border-radius: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <input id="ask" onkeydown="
            if (event.key === 'Enter') askOpenAI(this.value)
        ">
    <p id="response"></p>
    <script>
        async function askOpenAI(prompt) {
            const OPENAI_API_KEY = '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';
            const stak = `
                Your are T.I.M -> Timely Intelligence Mechanism
                Your job is to transform what someone says into integratable schedules
                NEVER reply with words unless there is not enough information, instead, SIMPLYreply with ONLY a JSON object with the properties needed
                Your object could look like this for instance:
                {"id":"1","username":"Iron Woman","email":"nicezara@gmail.com","password":"apple","itemName":"Make dua","itemDescription":"any dua","itemDate":"2025-07-05T00:00:00.000Z","itemStart":"18:00","itemEnd":null,"itemCategory":"other"}
                replace the username with user.username and replace password with user.password and replace the email with user.email, however, DO NOT WRAP THEM IN QUOTES
                The object must include EVERY FIELD -> username, password, email, id, itemName, itemDescription, itemDate, itemStart, itemEnd and itemCategory
                if there is not enough information, tell that to the user and remember to include the word 'information' in that response.
                The ID for the item should just be a random number from 0 to 999999999 please.
                The only categories are work, personal, shopping, to-do and other
                NEVER GUESS THE PASSWORD USERNAME OR EMAIL
            `;
            const user = JSON.parse(localStorage.getItem('savedUser'));
            if (!user) {
                alert('User not logged in')
                return;
            }
            document.getElementById('response').innerText = 'Thinking...';
            const response = await fetch("https://api.openai.com/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": "Bearer " + OPENAI_API_KEY,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    messages: [
                        { role: "system", content: stak },
                        { role: "user", content: prompt }
                    ]
                })
            });

            const data = await response.json();
            console.log("Raw response:", data);

            let reply = data.choices?.[0]?.message?.content;
            reply = reply.replace('user.username', user.username);
            reply = reply.replace('user.email', user.email);
            reply = reply.replace('user.password', user.password);

            console.log("OpenAI says:", reply);
            document.getElementById('response').innerText = 'Processing Information...';
            addScheduleToBackend(JSON.parse(reply));
        }
        async function addScheduleToBackend(schedule) {
            try {
                const response = await fetch('https://timely-zc0n.onrender.com/items/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(schedule)
                });
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`Failed to add schedule: ${response.status} - ${errorText}`);
                    throw new Error('Failed to add schedule');
                }
                document.getElementById('response').innerText = 'Item added sucessfully!';
                return await response.json();
            } catch (error) {
                console.error('Error in addScheduleToBackend:', error);
                return null;
            }
        }
    </script>
</body>
</html>
